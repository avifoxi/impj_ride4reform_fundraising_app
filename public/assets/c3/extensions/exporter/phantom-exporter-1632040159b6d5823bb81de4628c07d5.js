function checkNum(e){return e=parseInt(e),isNaN(e)?!1:e}function injectVerify(e){var t=page.injectJs(e);t||(console.log("\nError!\n"+e+" not found!\n"),phantom.exit(1))}String.prototype.format||(String.prototype.format=function(){var e=arguments;return this.replace(/{(\d+)}/g,function(t,n){return"undefined"!=typeof e[n]?e[n]:t})});var page=require("webpage").create(),fs=require("fs"),system=require("system"),config=JSON.parse(fs.read("config.json")),output,size;if(system.args.length<3)console.log("Usage: phantasm.js filename html [WxH]"),phantom.exit(1);else if(out=system.args[1],opts=JSON.parse(system.args[2]),system.args[3]){var dimensions=system.args[3].split("x"),width=dimensions[0],height=dimensions[1];width=checkNum(width),height=checkNum(height),width&&height&&(page.viewportSize={height:height,width:width}),opts.size||(opts.size={height:height,width:width})}else page.viewportSize={height:opts.size&&opts.size.height?opts.size.height:320,width:opts.size&&opts.size.width?opts.size.width:710};page.onResourceRequested=function(e){console.log("::loading resource ",e.url)},page.onConsoleMessage=function(e){console.log(e)},page.onError=function(e,t){var n=["ERROR: "+e];t&&t.length&&(n.push("TRACE:"),t.forEach(function(e){n.push(" -> "+e.file+": "+e.line+(e.function?' (in function "'+e.function+'")':""))})),console.error(n.join("\n"))},page.onLoadFinished=function(){console.log("::rendering");for(var e in config.js)injectVerify(config.js[e]);page.evaluate(function(e){Function.prototype.bind=Function.prototype.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}},c3.generate(e)},opts),setTimeout(function(){page.render(out),phantom.exit()},300)};var css="";for(var i in config.css)css+=fs.read(config.css[i]);page.content=config.template.format(css);